# LiveDrop 产品需求文档 (PRD)
## Product Requirements Document

**版本**: v1.0  
**日期**: 2025年2月  
**产品**: LiveDrop - 实时照片直播与分享平台

---

## 一、产品概述

### 1.1 产品定位

LiveDrop是一款现代化的照片实时直播与分享平台，专注于为活动现场（婚礼、派对、会议、展览等）提供简单、高效的照片即时分享服务。通过LiveDrop，摄影师或宾客可以轻松上传照片，现场观众扫码即可实时浏览高清照片，实现"即拍即传、扫码即看"的流畅体验。

### 1.2 核心价值主张

- **极简体验**: 无需下载App，扫码即用，3秒完成照片上传
- **实时同步**: 基于Supabase Realtime技术，照片上传后即时出现在大屏幕/投影仪
- **开箱即用**: 零配置部署，支持Cloudflare R2存储，全球CDN加速
- **双端支持**: 主持人管理后台 + 宾客上传端 + 实时展示端三位一体
- **隐私优先**: 支持照片审核机制，确保内容合规

### 1.3 目标用户

| 用户角色 | 需求场景 | 核心痛点 |
|---------|---------|---------|
| **活动摄影师** | 婚礼、派对、企业活动拍摄 | 快速交付照片，减少后期工作量 |
| **活动主办方** | 年会、展会、发布会 | 现场氛围营造，品牌传播 |
| **普通宾客** | 参加婚礼、聚会 | 即时获取和分享照片 |
| **现场导演** | 演出、赛事 | 实时大屏幕展示 |

### 1.4 竞品对比

| 功能维度 | LiveDrop (当前) | 一拍即传 (竞品) | 优势/差距分析 |
|---------|----------------|----------------|--------------|
| **核心技术** | Next.js + Supabase + R2 | 自研三云架构 | LiveDrop技术栈更现代，开发效率更高 |
| **部署方式** | 开源/自托管 | SaaS订阅制 | LiveDrop支持私有化部署，数据可控 |
| **实时同步** | ✅ WebSocket实时 | ✅ 实时上传 | 技术实现相当 |
| **AI修图** | ❌ 未实现 | ✅ AI美颜/瘦身/调色 | **核心差距**，需重点补齐 |
| **存储容量** | 取决于R2配置 | 宣称不限容量 | LiveDrop成本可控 |
| **水印功能** | ❌ 未实现 | ✅ 自定义水印 | 中等优先级功能 |
| **多摄影师** | ⚠️ 基础支持 | ✅ 协作功能完善 | 可快速增强 |
| **人脸识别** | ❌ 未实现 | ✅ AI人脸识别找图 | **高价值功能** |
| **社交互动** | ❌ 点赞/评论 | ✅ 点赞/打赏/评论 | 增值功能 |
| **使用成本** | 开源免费 | 99元/活动起 | LiveDrop成本优势明显 |
| **RAW支持** | ❌ JPEG only | ✅ RAW格式 | 专业摄影师需求 |
| **模板皮肤** | ❌ 默认主题 | ✅ 88套主题 | 品牌化需求 |

**关键洞察**: LiveDrop在核心技术架构和部署灵活性上具有优势，但在AI修图、人脸识别、社交互动等增值功能上存在明显差距。

---

## 二、现有功能架构

### 2.1 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                         LiveDrop 系统架构                      │
├─────────────────────────────────────────────────────────────┤
│  前端层 (Next.js 16 App Router)                              │
│  ├── /dashboard          主持人管理后台                       │
│  ├── /e/[slug]          宾客上传端 (Camera PWA)              │
│  ├── /live/[slug]       实时展示端 (Projector View)          │
│  └── /join              活动码加入页                          │
├─────────────────────────────────────────────────────────────┤
│  服务层                                                      │
│  ├── Supabase Auth       双认证体系 (Host+Guest Anonymous)    │
│  ├── Supabase Realtime   实时数据同步                         │
│  ├── Supabase PostgreSQL 元数据存储                          │
│  └── Cloudflare R2       对象存储 + CDN                      │
├─────────────────────────────────────────────────────────────┤
│  数据处理层                                                   │
│  ├── 客户端压缩 (Canvas API)    max 1920px, JPEG 85%         │
│  ├── 图片代理 API              /api/image/[...path]          │
│  └── 防抖/节流处理                                            │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 数据模型

**Events 表**
- `id`: UUID 主键
- `host_id`: UUID 外键 → auth.users
- `name`: 活动名称
- `slug`: 唯一活动码 (URL friendly)
- `qr_code_url`: 二维码图片URL
- `created_at`: 创建时间

**Photos 表**
- `id`: UUID 主键
- `event_id`: UUID 外键 → events
- `user_id`: UUID 外键 → auth.users (anonymous)
- `storage_path`: R2存储路径
- `is_visible`: 审核状态 (boolean)
- `created_at`: 上传时间

**RLS 安全策略**
- 活动: 公开读取，认证用户创建，仅主持人更新/删除
- 照片: 仅可见照片公开读取，认证用户上传，仅主持人审核

### 2.3 当前功能清单

#### 已实现 ✅

**主持人端 (Dashboard)**
- [x] 邮箱/密码注册登录
- [x] Google OAuth 登录
- [x] 创建/重命名/删除活动
- [x] 自动生成活动二维码
- [x] 复制活动链接
- [x] 下载二维码图片
- [x] 照片网格展示
- [x] 照片审核 (显示/隐藏)
- [x] 照片删除
- [x] 实时同步更新

**宾客端 (Guest Camera)**
- [x] 扫码/输入活动码加入
- [x] 自动匿名登录
- [x] 相机拍摄上传
- [x] 相册选择上传
- [x] 客户端图片压缩
- [x] 上传进度指示
- [x] 成功状态反馈

**展示端 (Live Gallery)**
- [x] 瀑布流布局 (Masonry)
- [x] 实时照片更新 (WebSocket)
- [x] 全屏模态查看器
- [x] 缩放控制 (0.5x - 3x)
- [x] 键盘导航支持
- [x] 单张下载
- [x] 连接状态指示

**系统功能**
- [x] PWA 支持 (Serwist)
- [x] 响应式设计
- [x] 国际化 (中英双语)
- [x] 暗黑主题
- [x] 图片懒加载
- [x] 防抖/节流优化

#### 未实现 ❌

**核心功能缺口**
- [ ] AI 自动修图 (调色/美颜/瘦身)
- [ ] 人脸识别与分组
- [ ] 照片水印
- [ ] 多视图模式 (时间轴/方格)
- [ ] 批量下载 (ZIP打包)
- [ ] 活动统计/数据分析

**高级功能缺口**
- [ ] 社交互动 (点赞/评论)
- [ ] 打赏功能
- [ ] 主题模板/皮肤切换
- [ ] 自定义品牌 (Logo/Banner)
- [ ] 视频上传支持
- [ ] RAW格式支持
- [ ] 多人协作权限管理

**运营功能缺口**
- [ ] 活动预约/排期
- [ ] 云备份策略
- [ ] 照片标签/分类
- [ ] 智能相册合辑
- [ ] 海报自动拼图

---

## 三、功能需求规划

### 3.1 Phase 1: 核心体验优化 (Q1 2025)

**目标**: 补齐基础功能缺口，提升核心用户体验

#### FR-1.1 多视图模式切换
**优先级**: P1 (高)  
**描述**: 在实时展示端支持时间轴和方格图两种浏览模式

**需求详情**:
- 时间轴模式: 按上传时间倒序排列，瀑布流布局
- 方格图模式: 统一尺寸网格，类似Instagram
- 视图切换按钮，状态持久化 (localStorage)
- 动画过渡效果

**技术方案**:
```typescript
// 新增视图模式类型
type ViewMode = 'masonry' | 'grid';

// Grid布局使用CSS Grid
// Masonry使用现有实现 (column-count)
```

**验收标准**:
- [ ] 用户可点击切换视图模式
- [ ] 切换时有平滑过渡动画
- [ ] 刷新页面后保持上次选择的视图
- [ ] 移动端适配良好

#### FR-1.2 照片水印功能
**优先级**: P1 (高)  
**描述**: 支持上传自定义水印图片，自动叠加到所有照片上

**需求详情**:
- 主持人可在活动设置中上传水印图片 (PNG透明背景)
- 支持设置水印位置 (九宫格定位)
- 支持设置水印透明度 (0-100%)
- 支持设置水印尺寸 (原图百分比)
- 服务端使用 Sharp/Canvas 处理

**技术方案**:
- 服务端使用 Sharp 库进行图片处理
- 水印配置存储在 events 表新增字段
- 上传时或展示时实时叠加 (需权衡性能)

**数据模型变更**:
```sql
ALTER TABLE events ADD COLUMN watermark_config JSONB DEFAULT NULL;
-- watermark_config: { url, position, opacity, scale }
```

**验收标准**:
- [ ] 支持上传PNG水印
- [ ] 可调整位置、透明度、大小
- [ ] 水印应用在所有公开照片上
- [ ] 处理性能 < 500ms/张

#### FR-1.3 批量下载功能
**优先级**: P1 (高)  
**描述**: 支持打包下载活动全部照片或选定照片

**需求详情**:
- 主持人端: 下载全部照片 (ZIP格式)
- 展示端: 访客可批量选择后下载
- 显示打包进度
- 支持按日期筛选后下载

**技术方案**:
- 使用 JSZip 客户端打包 (小批量)
- 或服务端使用 archiver 生成ZIP后提供下载链接
- 异步处理，通过轮询或WebSocket通知完成

**API设计**:
```typescript
// Server Action
async function createPhotoZip(eventId: string, photoIds?: string[]): Promise<{ downloadUrl: string }>
```

**验收标准**:
- [ ] 支持一键下载全部照片
- [ ] ZIP文件名包含活动名和日期
- [ ] 处理100张照片 < 30秒
- [ ] 下载链接有效期24小时

#### FR-1.4 照片统计面板
**优先级**: P2 (中)  
**描述**: 为每个活动提供数据统计面板

**需求详情**:
- 总照片数
- 今日上传数
- 在线观看人数 (实时)
- 下载次数统计
- 上传时间分布图表

**技术方案**:
- 利用 Supabase 聚合查询
- 前端使用 Recharts 展示图表
- 实时数据通过 Realtime 更新

**验收标准**:
- [ ] 展示核心统计数据
- [ ] 图表展示24小时上传趋势
- [ ] 数据自动刷新

---

### 3.2 Phase 2: AI能力构建 (Q2 2025)

**目标**: 引入AI能力，打造差异化竞争优势

#### FR-2.1 AI智能调色
**优先级**: P0 (最高)  
**描述**: 自动优化照片色彩，提供一键美化功能

**需求详情**:
- 自动调整亮度、对比度、饱和度
- 智能HDR效果增强
- 提供多种预设风格滤镜 (明亮/胶片/黑白/暖色等)
- 支持批量处理

**技术方案**:
- 方案A: 客户端使用 TensorFlow.js + 预训练模型
- 方案B: 集成第三方API (Cloudinary, Uploadcare)
- 方案C: 自建Python微服务 (OpenCV/PIL)

**推荐方案**: 先使用 Cloudinary 等成熟服务快速验证，后期考虑自研

**验收标准**:
- [ ] 上传后自动或手动触发调色
- [ ] 提供至少5种预设风格
- [ ] 处理时间 < 3秒/张
- [ ] 保留原图，可对比查看

#### FR-2.2 AI人脸识别与分组
**优先级**: P1 (高)  
**描述**: 自动识别照片中的人脸，支持按人分组浏览

**需求详情**:
- 自动检测照片中的人脸
- 人脸聚类 (同一人自动归类)
- 访客可标记"这是我"快速找到自己的照片
- 支持人脸搜索

**技术方案**:
- 使用 AWS Rekognition / Azure Face API / 阿里云人脸识别
- 或开源方案: face-api.js (客户端)
- 人脸特征向量存储在数据库

**数据模型变更**:
```sql
-- 新增人脸表
CREATE TABLE faces (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  photo_id UUID REFERENCES photos(id),
  face_encoding VECTOR(128),  -- 人脸特征向量 (pgvector扩展)
  bounding_box JSONB,         -- 人脸位置
  person_id UUID              -- 聚类后的人物ID
);

-- 新增人物表
CREATE TABLE persons (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  event_id UUID REFERENCES events(id),
  name TEXT,                  -- 可手动标记名字
  cover_photo_id UUID REFERENCES photos(id),
  photo_count INTEGER DEFAULT 0
);
```

**验收标准**:
- [ ] 自动检测90%以上清晰人脸
- [ ] 同一人聚类准确率 > 85%
- [ ] 支持"找我的照片"功能
- [ ] 处理100张照片 < 5分钟

#### FR-2.3 智能筛选与废片识别
**优先级**: P2 (中)  
**描述**: 自动识别并标记低质量照片

**需求详情**:
- 检测模糊照片 (清晰度评分)
- 检测闭眼照片
- 检测重复/相似照片
- 标记后主持人可选择隐藏

**技术方案**:
- 使用 OpenCV 或 TensorFlow 模型
- 图片质量评分算法
- 感知哈希计算相似度

**验收标准**:
- [ ] 自动标记模糊照片
- [ ] 自动标记闭眼照片
- [ ] 相似照片自动分组
- [ ] 主持人可一键隐藏所有废片

---

### 3.3 Phase 3: 社交与商业化 (Q3 2025)

**目标**: 增强社交属性，探索商业化功能

#### FR-3.1 社交互动功能
**优先级**: P1 (高)  
**描述**: 增加点赞、评论等互动功能

**需求详情**:
- 照片点赞 (心形按钮)
- 照片评论 (文字)
- 实时通知 (点赞/评论更新)
- 热门照片排序

**数据模型**:
```sql
CREATE TABLE photo_likes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  photo_id UUID REFERENCES photos(id),
  user_id UUID REFERENCES auth.users(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(photo_id, user_id)
);

CREATE TABLE photo_comments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  photo_id UUID REFERENCES photos(id),
  user_id UUID REFERENCES auth.users(id),
  content TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

**验收标准**:
- [ ] 用户可点赞/取消点赞
- [ ] 用户可发表评论
- [ ] 实时显示点赞数和评论
- [ ] 支持按热度排序

#### FR-3.2 主题模板与品牌定制
**优先级**: P2 (中)  
**描述**: 支持多种相册主题和品牌定制

**需求详情**:
- 提供多种预设主题 (婚礼/派对/企业/简约/暗黑)
- 自定义主色调
- 上传活动封面图
- 上传品牌Banner
- 自定义分享卡片样式

**技术方案**:
- 主题配置存储为 JSON Schema
- CSS Variables 动态主题切换
- 分享卡片使用 HTML-to-Image 生成

**验收标准**:
- [ ] 提供至少8套预设主题
- [ ] 支持自定义主色
- [ ] 支持上传封面和Banner
- [ ] 分享卡片展示品牌信息

#### FR-3.3 照片打赏功能
**优先级**: P3 (低)  
**描述**: 观众可向摄影师打赏

**需求详情**:
- 集成微信支付/支付宝
- 设置打赏金额选项
- 打赏后显示特效
- 主持人查看打赏统计

**技术方案**:
- 第三方支付SDK集成
- 独立的支付服务模块

**验收标准**:
- [ ] 支持主流支付方式
- [ ] 打赏流程流畅
- [ ] 实时显示打赏通知
- [ ] 提现功能

---

### 3.4 Phase 4: 专业功能 (Q4 2025)

**目标**: 满足专业摄影师需求

#### FR-4.1 RAW格式支持
**优先级**: P2 (中)  
**描述**: 支持上传RAW格式照片并自动转换

**需求详情**:
- 支持 CR2/CR3 (Canon)、NEF (Nikon)、ARW (Sony) 等格式
- 服务端自动转换为JPEG预览
- 提供RAW原图下载

**技术方案**:
- 使用 Darktable-cli 或 RawTherapee 进行转换
- Docker容器化处理

#### FR-4.2 多摄影师协作
**优先级**: P2 (中)  
**描述**: 支持多人同时上传，区分摄影师

**需求详情**:
- 邀请其他摄影师加入活动
- 不同摄影师照片区分标识
- 摄影师个人主页/作品集

#### FR-4.3 照片直播硬件集成
**优先级**: P3 (低)  
**描述**: 支持OTG数据线直连相机

**需求详情**:
- 相机通过OTG线连接手机
- 快门触发自动上传
- 支持主流相机品牌

---

## 四、技术债务与优化

### 4.1 性能优化

| 优化项 | 现状 | 目标 | 方案 |
|-------|------|------|------|
| 图片加载 | 直接R2 URL | 懒加载 + 渐进式 | 使用 blur-up 占位 |
| 首屏渲染 | 全量加载 | 骨架屏 + 分页 | 虚拟滚动 |
| 大活动支持 | 无限制加载 | 分页加载 | 每页50张 |
| 压缩算法 | Canvas基础压缩 | 更优压缩率 | 使用 mozjpeg |
| 上传并发 | 单文件 | 多文件队列 | 并发3个 |

### 4.2 代码架构改进

- [ ] 提取通用 hooks (useRealtime, useInfiniteScroll)
- [ ] 图片处理服务抽象层
- [ ] 错误边界和监控集成 (Sentry)
- [ ] E2E测试覆盖 (Playwright)
- [ ] 性能监控 (Vercel Analytics)

### 4.3 安全加固

- [ ] 图片病毒扫描 (ClamAV)
- [ ] 内容安全策略 (CSP)
- [ ] 上传频率限制 (Rate Limiting)
- [ ] 敏感内容检测 (AWS Rekognition)

---

## 五、UI/UX设计规范

### 5.1 设计原则

- **简洁至上**: 界面元素克制，突出照片内容
- **即时反馈**: 所有操作有明确的视觉/动效反馈
- **一致性**: 遵循既定设计系统，保持交互统一
- **无障碍**: 支持键盘导航，满足WCAG 2.1 AA标准

### 5.2 色彩系统

```css
:root {
  /* 主色调 - 深蓝 */
  --primary: 217 91% 60%;
  --primary-foreground: 0 0% 100%;
  
  /* 背景色 - 暗黑主题 */
  --background: 222 47% 11%;
  --foreground: 210 40% 98%;
  
  /* 语义色 */
  --success: 142 76% 36%;
  --warning: 38 92% 50%;
  --danger: 0 84% 60%;
  --info: 199 89% 48%;
}
```

### 5.3 组件规范

- **按钮**: 圆角 8px，主操作使用实心，次要使用描边
- **卡片**: 圆角 12px， subtle 阴影
- **图片**: 默认圆角 8px，悬停放大 1.02x
- **输入框**: 高度 44px，聚焦时主色边框
- **间距**: 基础单位 4px，遵循 4px grid system

---

## 六、数据指标与OKR

### 6.1 核心指标 (North Star Metrics)

| 指标 | 当前 | Q1目标 | Q2目标 |
|------|------|--------|--------|
| 照片上传成功率 | 95% | 98% | 99% |
| 端到端延迟 (拍摄→显示) | 5s | 3s | 2s |
| 实时画廊刷新延迟 | <1s | <500ms | <300ms |
| 月活跃活动数 | - | 100+ | 500+ |
| 用户NPS评分 | - | >40 | >50 |

### 6.2 技术指标

| 指标 | 目标 |
|------|------|
| 首屏加载时间 (FCP) | < 1.5s |
| 可交互时间 (TTI) | < 3s |
| API响应时间 (P95) | < 200ms |
| 系统可用性 | 99.9% |

---

## 七、风险与应对

| 风险 | 可能性 | 影响 | 应对策略 |
|------|--------|------|---------|
| AI功能实现复杂度高 | 中 | 高 | 先集成第三方API验证需求，再考虑自研 |
| 存储成本快速增长 | 中 | 中 | 实施存储配额策略，提供清理工具 |
| 竞品价格战 | 高 | 中 | 强化开源和私有化部署差异化优势 |
| 图片版权纠纷 | 低 | 高 | 增加版权声明和用户协议，提供举报机制 |
| 大活动并发压力 | 中 | 高 | 提前进行压力测试，准备扩容方案 |

---

## 八、附录

### 8.1 竞品功能详细分析

**一拍即传核心优势**:
- 十年技术积累，三云架构高可用
- AI修图算法成熟，效果自然
- 完善的摄影师生态和培训体系
- 硬件集成能力强 (OTG直连)

**其局限性**:
- 闭源SaaS，数据不可控
- 价格较高，按活动收费
- 定制化能力弱
- 不支持私有化部署

### 8.2 技术选型参考

**AI图像处理**:
- 快速方案: Cloudinary / Uploadcare (付费但成熟)
- 自研方案: Python + FastAPI + OpenCV/TensorFlow
- 客户端: TensorFlow.js (轻量但能力有限)

**人脸识别**:
- 商业: AWS Rekognition, Azure Face API
- 开源: face-api.js, dlib

**图像存储**:
- 当前: Cloudflare R2 (成本优势明显)
- 备选: AWS S3, 阿里云OSS

### 8.3 版本历史

| 版本 | 日期 | 修改内容 |
|------|------|---------|
| v1.0 | 2025-02-10 | 初始版本，基于当前代码库和竞品分析 |

---

**文档维护**: 产品团队  
**下次评审**: 2025-03-10
